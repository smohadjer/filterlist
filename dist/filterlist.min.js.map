{
  "version": 3,
  "sources": ["../src/filterlist.ts"],
  "sourcesContent": ["'use strict';\n\ntype filter = {\n\tname: string,\n\tvalue?: string,\n\tignoreValue?: string\n};\ntype filters = filter[];\ntype filterNames = string[];\n\ninterface Options {\n\telement: HTMLElement;\n\texcludeFromFilteringClass?: string;\n\thiddenClass?: string;\n\tlastClass?: string;\n\tfilters?: filters;\n\turlIsUpdatable?: boolean;\n\tfilterNames?: filterNames;\n\tinitCallback?: Function;\n\tfiltersCallback?: Function;\n};\n\nexport default class Filterlist {\n\telement: HTMLElement;\n\texcludeClass: string;\n\thiddenClass: string | undefined;\n\tlastClass: string;\n\tfilters: filters;\n\turlIsUpdatable: boolean;\n\tfilterNames: filterNames;\n\tinitCallback: Function | undefined\n\tfiltersCallback: Function | undefined;\n\n\tconstructor(options: Options) {\n\t\tthis.element = options.element;\n\t\tthis.excludeClass = options.excludeFromFilteringClass || 'filterList__exclude';\n\t\tthis.hiddenClass = options.hiddenClass;\n\t\tthis.lastClass = options.lastClass || 'last';\n\t\tthis.filters = [];\n\t\tthis.urlIsUpdatable = options.urlIsUpdatable || false;\n\t\tthis.filterNames = [];\n\t\tthis.initCallback = options.initCallback;\n\t\tthis.filtersCallback = options.filtersCallback;\n\n\t\tif (this.element && this.element.hasAttribute('data-filter-names')) {\n\t\t\tconst attr = this.element.getAttribute('data-filter-names');\n\t\t\tif (attr && attr.length > 0) {\n\t\t\t\tthis.filterNames = attr.split(' ');\n\t\t\t} else {\n\t\t\t\tconsole.warn('data-filter-names has no value');\n\t\t\t\treturn;\n\t\t\t}\n\t\t} else {\n\t\t\tconsole.warn('Element not found or has no data-filter-names attribute!');\n\t\t\treturn;\n\t\t}\n\n\t\tthis.setEventHandlers();\n\t\tthis.setDefaultFilters(this.filterNames);\n\t\tthis.updateFiltersfromURL();\n\t\tthis.updateBrowserHistory();\n\n\t\tif (typeof this.initCallback === 'function') {\n\t\t\tthis.initCallback();\n\t\t}\n\n\t\tthis.applyFilters(this.element);\n\t}\n\n\tupdateBrowserHistory() {\n\t\tif (this.urlIsUpdatable) {\n\t\t\thistory.replaceState({filters: this.filters}, document.title, window.location.href);\n\t\t}\n\t}\n\n\tsetDefaultFilters(filterNames: filterNames) {\n\t\tfilterNames.forEach((filterName) => {\n\t\t\tconst ignoreValue = this.getFilterIgnoreValue(filterName);\n\t\t\tconst filterValue = this.getFilterValue(filterName);\n\n\t\t\tthis.filters.push({\n\t\t\t\tname: filterName,\n\t\t\t\tvalue: filterValue,\n\t\t\t\tignoreValue: ignoreValue\n\t\t\t});\n\t\t});\n\t}\n\n\tgetFilterIgnoreValue(filterName: string) {\n\t\tconst filterElement = document.querySelector(`[name=\"${filterName}\"]`) as HTMLInputElement;\n\t\tlet value: string | undefined = undefined;\n\n\t\tif (filterElement) {\n\t\t\tconst dataAttr = filterElement.getAttribute('data-ignore');\n\t\t\tif (filterElement.tagName === 'SELECT') {\n\t\t\t\tvalue = dataAttr || undefined;\n\t\t\t}\n\t\t} else {\n\t\t\tconsole.warn('No filter with name ' + filterName + ' was found in markup!');\n\t\t}\n\n\t\treturn value;\n\t}\n\n\tgetFilterValue(filterName: string) {\n\t\tconst filterElement = document.querySelector(`[name=\"${filterName}\"]`) as HTMLInputElement;\n\t\tlet value: string | undefined = undefined;\n\n\t\tif (filterElement) {\n\t\t\tif (filterElement.getAttribute('type') === 'checkbox') {\n\t\t\t\tvalue = filterElement.checked ? filterElement.value : undefined;\n\t\t\t} else {\n\t\t\t\tvalue = filterElement.value;\n\t\t\t}\n\t\t} else {\n\t\t\tconsole.warn('No filter with name ' + filterName + ' was found in markup!');\n\t\t}\n\n\t\treturn value;\n\t}\n\n\tupdateFiltersfromURL() {\n\t\tthis.filterNames.forEach((filterName) => {\n\t\t\tconst searchParams = new URLSearchParams(window.location.search);\n\t\t\tconst newValue = searchParams.get(filterName);\n\n\t\t\tif (newValue) {\n\t\t\t\tthis.updateFilters({\n\t\t\t\t\tname: filterName,\n\t\t\t\t\tvalue: newValue\n\t\t\t\t});\n\n\t\t\t\tthis.updateDOM(this.filters);\n\t\t\t}\n\t\t});\n\t}\n\n\tupdateFilters(updatedFilter) {\n\t\tlet filter = this.filters.find((filter) => filter.name === updatedFilter.name);\n\n\t\tif (filter && filter.value !== updatedFilter.value) {\n\t\t\tfilter.value = updatedFilter.value;\n\t\t\tthis.applyFilters(this.element);\n\t\t}\n\t}\n\n\tsetEventHandlers() {\n\t\tthis.filterNames.forEach((filterName) => {\n\t\t\tconst filterElement = document.querySelector('[name=\"' + filterName + '\"]');\n\n\t\t\tif (filterElement) {\n\t\t\t\tfilterElement.addEventListener('change', () => {\n\t\t\t\t\tthis.updateFilters({\n\t\t\t\t\t\tname: filterName,\n\t\t\t\t\t\tvalue: this.getFilterValue(filterName)\n\t\t\t\t\t});\n\n\t\t\t\t\tif (this.urlIsUpdatable) {\n\t\t\t\t\t\tconst url = this.updateURL(new URL(window.location.href), this.filters);\n\t\t\t\t\t\thistory.pushState({filters: this.filters}, document.title, url);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tif (this.urlIsUpdatable) {\n\t\t\twindow.addEventListener(\"popstate\", (e) => {\n\t\t\t\tif (e.state.filters) {\n\t\t\t\t\tfor (let prop in e.state.filters) {\n\t\t\t\t\t\tthis.filters[prop] = e.state.filters[prop];\n\t\t\t\t\t};\n\n\t\t\t\t\tthis.updateDOM(e.state.filters);\n\t\t\t\t\tthis.applyFilters(this.element);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tupdateDOM(filters) {\n\t\tfilters.forEach((filter) => {\n\t\t\tconst element: HTMLSelectElement | HTMLInputElement | null = document.querySelector(`[name=\"${filter.name}\"]`);\n\t\t\tif (element) {\n\t\t\t\tif (element.tagName === 'SELECT') {\n\t\t\t\t\telement.value = filter.value;\n\t\t\t\t} else if (element.tagName === 'INPUT') {\n\t\t\t\t\tif (element.getAttribute('type') === 'checkbox') {\n\t\t\t\t\t\t(element as HTMLInputElement).checked = (element.value === filter.value) ? true : false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\t//public method for changing filters via other scripts\n\tsetFilters(filters) {\n\t\tfor (let property in filters) {\n\t\t\tthis.filters.forEach(function(item) {\n\t\t\t\tif (item.name === property) {\n\t\t\t\t\titem.value = filters[property];\n\t\t\t\t}\n\t\t\t});\n\t\t};\n\n\t\tthis.updateDOM(this.filters);\n\t\tthis.applyFilters(this.element);\n\n\t\tif (this.urlIsUpdatable) {\n\t\t\tconst url = this.updateURL(new URL(window.location.href), this.filters);\n\t\t\thistory.pushState({filters: this.filters}, document.title, url);\n\t\t}\n\t}\n\n\t// returns elements that match all applicable filters\n\tgetMatchedItems(listItems: HTMLElement[]) {\n\t\tconst matchedItems: HTMLElement[] = [];\n\n\t\t// exclude filters that are not set or have ignoreValue as they play no role in filtering\n\t\tconst applicableFilters = this.filters.filter((item) => {\n\t\t\treturn item.value !== undefined && item.value !== item.ignoreValue;\n\t\t});\n\n\t\tlistItems.forEach((element) => {\n\t\t\tlet matched = true;\n\n\t\t\tapplicableFilters.forEach((filter) => {\n\t\t\t\t\tconst hasThisFilter = element.hasAttribute('data-filter-' + filter.name);\n\t\t\t\t\tconst filterValue =  element.getAttribute('data-filter-' + filter.name);\n\t\t\t\t\tconst elementMatchesFilter = (filterValue && filter.value) ? filterValue.split(' ').includes(filter.value) : false;\n\n\t\t\t\t\tif (!hasThisFilter || !elementMatchesFilter) {\n\t\t\t\t\t\tmatched = false;\n\t\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (matched) {\n\t\t\t\tmatchedItems.push(element);\n\t\t\t}\n\t\t});\n\n\t\treturn matchedItems;\n\t}\n\n\tapplyFilters(element: HTMLElement) {\n\t\tconst listItems = [...element.children].filter((item) => {return !item.classList.contains(this.excludeClass)});\n\t\tconst matchedItems = this.getMatchedItems(listItems as HTMLElement[]);\n\n\t\t// hide all items\n\t\tlistItems.forEach((el) => {\n\t\t\tthis.hiddenClass ? el.classList.add(this.hiddenClass) :\n\t\t\t\tel.setAttribute('hidden', 'hidden');\n\t\t});\n\n\t\t// unhide matched items\n\t\tif (matchedItems.length === 0) {\n\t\t\telement.classList.add('is-empty');\n\t\t} else {\n\t\t\tmatchedItems.forEach((item) => {\n\t\t\t\tthis.hiddenClass ? item.classList.remove(this.hiddenClass) :\n\t\t\t\t\titem.removeAttribute('hidden');\n\t\t\t});\n\t\t\telement.classList.remove('is-empty');\n\t\t}\n\n\t\t//add a class to last visible item\n\t\tif (this.lastClass) {\n\t\t\tconst lastVisibleElement = element.querySelector(`.${this.lastClass}`);\n\t\t\tif (lastVisibleElement) {\n\t\t\t\tlastVisibleElement.classList.remove(this.lastClass);\n\t\t\t}\n\n\t\t\tif (matchedItems.length > 0) {\n\t\t\t\tmatchedItems[matchedItems.length - 1].classList.add(this.lastClass);\n\t\t\t}\n\t\t}\n\n\t\tif (typeof this.filtersCallback === 'function') {\n\t\t\tthis.filtersCallback();\n\t\t}\n\t}\n\n\t// url is a URL object\n\tupdateURL(url: URL, filters:filters) {\n\t\tfilters.forEach((filter) => {\n\t\t\tif (filter.value === undefined ||\n\t\t\t\tfilter.value.length === 0 ||\n\t\t\t\tfilter.value === filter.ignoreValue) {\n\t\t\t\turl.searchParams.delete(filter.name);\n\t\t\t} else {\n\t\t\t\turl.searchParams.set(filter.name, filter.value);\n\t\t\t}\n\t\t});\n\n\t\treturn url;\n\t}\n}\n"],
  "mappings": "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",
  "names": ["Filterlist", "options", "attr", "filterNames", "filterName", "ignoreValue", "filterValue", "filterElement", "value", "dataAttr", "newValue", "updatedFilter", "filter", "url", "prop", "filters", "element", "property", "item", "listItems", "matchedItems", "applicableFilters", "matched", "hasThisFilter", "elementMatchesFilter", "el", "lastVisibleElement"]
}
