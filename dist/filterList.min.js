var l=class{constructor(e){this.element=e.element,this.urlIsUpdatable=e.urlIsUpdatable||!1,this.filters=[],this.filterNames=this.element.getAttribute("data-filter-names").split(" "),this.initCallback=e.initCallback,this.filtersCallback=e.filtersCallback,this.lastClass=e.lastClass||"last",this.hiddenClass=e.hiddenClass,this.excludeClass=e.excludeFromFilteringClass||"filterList__exclude",this.setEventHandlers(),this.setDefaultFilters(this.filterNames),this.updateFiltersfromURL(),this.updateBrowserHistory(),typeof this.initCallback=="function"&&this.initCallback(),this.applyFilters(this.element)}updateBrowserHistory(){this.urlIsUpdatable&&history.replaceState({filters:this.filters},document.title,window.location.href)}setDefaultFilters(e){e.forEach(s=>{let t=this.getFilterIgnoreValue(s),i=this.getFilterValue(s);this.filters.push({name:s,value:i,ignoreValue:t})})}getFilterIgnoreValue(e){let s=document.querySelector(`[name="${e}"]`),t;return s?s.tagName==="SELECT"&&(t=s.getAttribute("data-ignore")):console.warn("No filter with name "+e+" was found in markup!"),t}getFilterValue(e){let s=document.querySelector(`[name="${e}"]`),t;return s?s.getAttribute("type")==="checkbox"?t=s.checked?s.value:void 0:t=s.value:console.warn("No filter with name "+e+" was found in markup!"),t}updateFiltersfromURL(){this.filterNames.forEach(e=>{let t=new URLSearchParams(window.location.search).get(e);t&&(this.updateFilters({name:e,value:t}),this.updateDOM(this.filters))})}updateFilters(e){let s=this.filters.find(t=>t.name===e.name);s&&s.value!==e.value&&(s.value=e.value,this.applyFilters(this.element))}setEventHandlers(){this.filterNames.forEach(e=>{let s=document.querySelector('[name="'+e+'"]');s&&s.addEventListener("change",()=>{if(this.updateFilters({name:e,value:this.getFilterValue(e)}),this.urlIsUpdatable){let t=this.updateURL(new URL(window.location.href),this.filters);history.pushState({filters:this.filters},document.title,t)}})}),this.urlIsUpdatable&&window.history&&window.history.pushState&&window.addEventListener("popstate",e=>{if(e.state.filters){for(let s in e.state.filters)this.filters[s]=e.state.filters[s];this.updateDOM(e.state.filters),this.applyFilters(this.element)}})}updateDOM(e){e.forEach(s=>{let t=document.querySelector(`[name="${s.name}"]`);t&&(t.tagName==="SELECT"?t.value=s.value:t.tagName==="INPUT"&&t.getAttribute("type")==="checkbox"&&(t.checked=t.value===s.value))})}setFilters(e){for(let s in e)this.filters.forEach(function(t){t.name===s&&(t.value=e[s])});if(this.updateDOM(this.filters),this.applyFilters(this.element),this.urlIsUpdatable){let s=this.updateURL(new URL(window.location.href),this.filters);history.pushState({filters:this.filters},document.title,s)}}getMatchedItems(e){let s=[];return e.forEach(t=>{let i=!0;this.filters.filter(a=>a.value!==void 0&&a.value!==a.ignoreValue).forEach(a=>{let r=t.hasAttribute("data-filter-"+a.name),n=t.getAttribute("data-filter-"+a.name);(!r||!n.split(" ").includes(a.value))&&(i=!1)}),i&&s.push(t)}),s}applyFilters(e){let s=[...e.children].filter(i=>!i.classList.contains(this.excludeClass)),t=this.getMatchedItems(s);if(s.forEach(i=>{this.hiddenClass?i.classList.add(this.hiddenClass):i.setAttribute("hidden","hidden")}),t.length===0?e.classList.add("is-empty"):(t.forEach(i=>{this.hiddenClass?i.classList.remove(this.hiddenClass):i.removeAttribute("hidden")}),e.classList.remove("is-empty")),this.lastClass){let i=e.querySelector(`.${this.lastClass}`);i&&i.classList.remove(this.lastClass),t[t.length-1].classList.add(this.lastClass)}typeof this.filtersCallback=="function"&&this.filtersCallback()}updateURL(e,s){return s.forEach(t=>{t.value===void 0||t.value.length===0||t.value===t.ignoreValue?e.searchParams.delete(t.name):e.searchParams.set(t.name,t.value)}),e}};export{l as default};
//# sourceMappingURL=filterList.min.js.map
