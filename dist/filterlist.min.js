var a=class{element;excludeClass;hiddenClass;lastClass;filters;urlIsUpdatable;filterNames;initCallback;filtersCallback;constructor(e){if(this.element=e.element,this.excludeClass=e.excludeFromFilteringClass||"filterList__exclude",this.hiddenClass=e.hiddenClass,this.lastClass=e.lastClass||"last",this.filters=[],this.urlIsUpdatable=e.urlIsUpdatable||!1,this.filterNames=[],this.initCallback=e.initCallback,this.filtersCallback=e.filtersCallback,this.element&&this.element.hasAttribute("data-filter-names")){let t=this.element.getAttribute("data-filter-names");if(t&&t.length>0)this.filterNames=t.split(" ");else{console.warn("data-filter-names has no value");return}}else{console.warn("Element not found or has no data-filter-names attribute!");return}this.setEventHandlers(),this.setDefaultFilters(this.filterNames),this.updateFiltersfromURL(),this.updateBrowserHistory(),typeof this.initCallback=="function"&&this.initCallback(),this.applyFilters(this.element)}updateBrowserHistory(){this.urlIsUpdatable&&history.replaceState({filters:this.filters},document.title,window.location.href)}setDefaultFilters(e){e.forEach(t=>{let s=this.getFilterIgnoreValue(t),l=this.getFilterValue(t);this.filters.push({name:t,value:l,ignoreValue:s})})}getFilterIgnoreValue(e){let t=document.querySelector(`[name="${e}"]`),s;if(t){let l=t.getAttribute("data-ignore");t.tagName==="SELECT"&&(s=l||void 0)}else console.warn("No filter with name "+e+" was found in markup!");return s}getFilterValue(e){let t=document.querySelector(`[name="${e}"]`),s;return t?t.getAttribute("type")==="checkbox"?s=t.checked?t.value:void 0:s=t.value:console.warn("No filter with name "+e+" was found in markup!"),s}updateFiltersfromURL(){this.filterNames.forEach(e=>{let s=new URLSearchParams(window.location.search).get(e);s&&(this.updateFilters({name:e,value:s}),this.updateDOM(this.filters))})}updateFilters(e){let t=this.filters.find(s=>s.name===e.name);t&&t.value!==e.value&&(t.value=e.value,this.applyFilters(this.element))}setEventHandlers(){this.filterNames.forEach(e=>{let t=document.querySelector('[name="'+e+'"]');t&&t.addEventListener("change",()=>{if(this.updateFilters({name:e,value:this.getFilterValue(e)}),this.urlIsUpdatable){let s=this.updateURL(new URL(window.location.href),this.filters);history.pushState({filters:this.filters},document.title,s)}})}),this.urlIsUpdatable&&window.addEventListener("popstate",e=>{if(e.state.filters){for(let t in e.state.filters)this.filters[t]=e.state.filters[t];this.updateDOM(e.state.filters),this.applyFilters(this.element)}})}updateDOM(e){e.forEach(t=>{let s=document.querySelector(`[name="${t.name}"]`);s&&(s.tagName==="SELECT"?s.value=t.value:s.tagName==="INPUT"&&s.getAttribute("type")==="checkbox"&&(s.checked=s.value===t.value))})}setFilters(e){for(let t in e)this.filters.forEach(function(s){s.name===t&&(s.value=e[t])});if(this.updateDOM(this.filters),this.applyFilters(this.element),this.urlIsUpdatable){let t=this.updateURL(new URL(window.location.href),this.filters);history.pushState({filters:this.filters},document.title,t)}}getMatchedItems(e){let t=[],s=this.filters.filter(l=>l.value!==void 0&&l.value!==l.ignoreValue);return e.forEach(l=>{let n=!0;s.forEach(i=>{let u=l.hasAttribute("data-filter-"+i.name),r=l.getAttribute("data-filter-"+i.name),h=r&&i.value?r.split(" ").includes(i.value):!1;(!u||!h)&&(n=!1)}),n&&t.push(l)}),t}applyFilters(e){let t=[...e.children].filter(l=>!l.classList.contains(this.excludeClass)),s=this.getMatchedItems(t);if(t.forEach(l=>{this.hiddenClass?l.classList.add(this.hiddenClass):l.setAttribute("hidden","hidden")}),s.length===0?e.classList.add("is-empty"):(s.forEach(l=>{this.hiddenClass?l.classList.remove(this.hiddenClass):l.removeAttribute("hidden")}),e.classList.remove("is-empty")),this.lastClass){let l=e.querySelector(`.${this.lastClass}`);l&&l.classList.remove(this.lastClass),s.length>0&&s[s.length-1].classList.add(this.lastClass)}typeof this.filtersCallback=="function"&&this.filtersCallback()}updateURL(e,t){return t.forEach(s=>{s.value===void 0||s.value.length===0||s.value===s.ignoreValue?e.searchParams.delete(s.name):e.searchParams.set(s.name,s.value)}),e}};export{a as default};
//# sourceMappingURL=filterlist.min.js.map
