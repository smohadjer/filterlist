{
  "version": 3,
  "sources": ["../src/filterlist.ts"],
  "sourcesContent": ["'use strict';\n\ntype filter = {\n\tname: string,\n\tvalue?: string,\n\tignoreValue?: string\n};\ntype filters = filter[];\ntype filterNames = string[];\n\ninterface Options {\n\telement: HTMLElement;\n\texcludeFromFilteringClass?: string;\n\thiddenClass?: string;\n\tlastClass?: string;\n\tfilters?: filters;\n\turlIsUpdatable?: boolean;\n\tfilterNames?: filterNames;\n\tinitCallback?: Function;\n\tfiltersCallback?: Function;\n};\n\nexport default class Filterlist {\n\telement: HTMLElement;\n\texcludeClass: string;\n\thiddenClass: string | undefined;\n\tlastClass: string;\n\tfilters: filters;\n\turlIsUpdatable: boolean;\n\tfilterNames: filterNames;\n\tinitCallback: Function | undefined\n\tfiltersCallback: Function | undefined;\n\n\tconstructor(options: Options) {\n\t\tthis.element = options.element;\n\t\tthis.excludeClass = options.excludeFromFilteringClass || 'filterList__exclude';\n\t\tthis.hiddenClass = options.hiddenClass;\n\t\tthis.lastClass = options.lastClass || 'last';\n\t\tthis.filters = [];\n\t\tthis.urlIsUpdatable = options.urlIsUpdatable || false;\n\t\tthis.filterNames = [];\n\t\tthis.initCallback = options.initCallback;\n\t\tthis.filtersCallback = options.filtersCallback;\n\n\t\tif (this.element && this.element.hasAttribute('data-filter-names')) {\n\t\t\tconst attr = this.element.getAttribute('data-filter-names');\n\t\t\tif (attr && attr.length > 0) {\n\t\t\t\tthis.filterNames = attr.split(' ');\n\t\t\t} else {\n\t\t\t\tconsole.warn('data-filter-names has no value');\n\t\t\t\treturn;\n\t\t\t}\n\t\t} else {\n\t\t\tconsole.warn('Element not found or has no data-filter-names attribute!');\n\t\t\treturn;\n\t\t}\n\n\t\tthis.setEventHandlers();\n\t\tthis.setDefaultFilters(this.filterNames);\n\t\tthis.updateFiltersfromURL();\n\t\tthis.updateBrowserHistory();\n\n\t\tif (typeof this.initCallback === 'function') {\n\t\t\tthis.initCallback();\n\t\t}\n\n\t\tthis.applyFilters(this.element);\n\t}\n\n\tupdateBrowserHistory() {\n\t\tif (this.urlIsUpdatable) {\n\t\t\thistory.replaceState({filters: this.filters}, document.title, window.location.href);\n\t\t}\n\t}\n\n\tsetDefaultFilters(filterNames: filterNames) {\n\t\tfilterNames.forEach((filterName) => {\n\t\t\tconst ignoreValue = this.getFilterIgnoreValue(filterName);\n\t\t\tconst filterValue = this.getFilterValue(filterName);\n\n\t\t\tthis.filters.push({\n\t\t\t\tname: filterName,\n\t\t\t\tvalue: filterValue,\n\t\t\t\tignoreValue: ignoreValue\n\t\t\t});\n\t\t});\n\t}\n\n\tgetFilterIgnoreValue(filterName: string) {\n\t\tconst filterElement = document.querySelector(`[name=\"${filterName}\"]`) as HTMLInputElement;\n\t\tlet value: string | undefined = undefined;\n\n\t\tif (filterElement) {\n\t\t\tconst dataAttr = filterElement.getAttribute('data-ignore');\n\t\t\tif (filterElement.tagName === 'SELECT') {\n\t\t\t\tvalue = dataAttr || undefined;\n\t\t\t}\n\t\t} else {\n\t\t\tconsole.warn('No filter with name ' + filterName + ' was found in markup!');\n\t\t}\n\n\t\treturn value;\n\t}\n\n\tgetFilterValue(filterName: string) {\n\t\tconst filterElement = document.querySelector(`[name=\"${filterName}\"]`) as HTMLInputElement;\n\t\tlet value: string | undefined = undefined;\n\n\t\tif (filterElement) {\n\t\t\tif (filterElement.getAttribute('type') === 'checkbox') {\n\t\t\t\tvalue = filterElement.checked ? filterElement.value : undefined;\n\t\t\t} else {\n\t\t\t\tvalue = filterElement.value;\n\t\t\t}\n\t\t} else {\n\t\t\tconsole.warn('No filter with name ' + filterName + ' was found in markup!');\n\t\t}\n\n\t\treturn value;\n\t}\n\n\tupdateFiltersfromURL() {\n\t\tthis.filterNames.forEach((filterName) => {\n\t\t\tconst searchParams = new URLSearchParams(window.location.search);\n\t\t\tconst newValue = searchParams.get(filterName);\n\n\t\t\tif (newValue) {\n\t\t\t\tthis.updateFilters({\n\t\t\t\t\tname: filterName,\n\t\t\t\t\tvalue: newValue\n\t\t\t\t});\n\n\t\t\t\tthis.updateDOM(this.filters);\n\t\t\t}\n\t\t});\n\t}\n\n\tupdateFilters(updatedFilter) {\n\t\tlet filter = this.filters.find(filter => filter.name === updatedFilter.name);\n\n\t\tif (filter && filter.value !== updatedFilter.value) {\n\t\t\tfilter.value = updatedFilter.value;\n\t\t\tthis.applyFilters(this.element);\n\t\t}\n\t}\n\n\tsetEventHandlers() {\n\t\tthis.filterNames.forEach((filterName) => {\n\t\t\tconst filterElement = document.querySelector('[name=\"' + filterName + '\"]');\n\n\t\t\tif (filterElement) {\n\t\t\t\tfilterElement.addEventListener('change', () => {\n\t\t\t\t\tthis.updateFilters({\n\t\t\t\t\t\tname: filterName,\n\t\t\t\t\t\tvalue: this.getFilterValue(filterName)\n\t\t\t\t\t});\n\n\t\t\t\t\tif (this.urlIsUpdatable) {\n\t\t\t\t\t\tconst url = this.updateURL(new URL(window.location.href), this.filters);\n\t\t\t\t\t\thistory.pushState({filters: this.filters}, document.title, url);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tif (this.urlIsUpdatable) {\n\t\t\twindow.addEventListener(\"popstate\", (e) => {\n\t\t\t\tif (e.state.filters) {\n\t\t\t\t\tfor (let prop in e.state.filters) {\n\t\t\t\t\t\tthis.filters[prop] = e.state.filters[prop];\n\t\t\t\t\t};\n\n\t\t\t\t\tthis.updateDOM(e.state.filters);\n\t\t\t\t\tthis.applyFilters(this.element);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tupdateDOM(filters) {\n\t\tfilters.forEach((filter) => {\n\t\t\tconst element: HTMLSelectElement | HTMLInputElement | null =\n\t\t\t\tdocument.querySelector(`[name=\"${filter.name}\"]`);\n\t\t\tif (element) {\n\t\t\t\tif (element.tagName === 'SELECT') {\n\t\t\t\t\telement.value = filter.value;\n\t\t\t\t} else if (element.tagName === 'INPUT') {\n\t\t\t\t\tif (element.getAttribute('type') === 'checkbox') {\n\t\t\t\t\t\t(element as HTMLInputElement).checked =\n\t\t\t\t\t\t\t(element.value === filter.value) ? true : false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\t//public method for changing filters via other scripts\n\tsetFilters(filters) {\n\t\tfor (let property in filters) {\n\t\t\tthis.filters.forEach(function(item) {\n\t\t\t\tif (item.name === property) {\n\t\t\t\t\titem.value = filters[property];\n\t\t\t\t}\n\t\t\t});\n\t\t};\n\n\t\tthis.updateDOM(this.filters);\n\t\tthis.applyFilters(this.element);\n\n\t\tif (this.urlIsUpdatable) {\n\t\t\tconst url = this.updateURL(new URL(window.location.href), this.filters);\n\t\t\thistory.pushState({filters: this.filters}, document.title, url);\n\t\t}\n\t}\n\n\t// returns elements that match all applicable filters\n\tgetMatchedItems(listItems: HTMLElement[]) {\n\t\tconst matchedItems: HTMLElement[] = [];\n\n\t\t// exclude filters that are not set or have ignoreValue as they play no role in filtering\n\t\tconst applicableFilters = this.filters.filter((item) => {\n\t\t\treturn item.value !== undefined && item.value !== item.ignoreValue;\n\t\t});\n\n\t\tlistItems.forEach((element) => {\n\t\t\tlet matched = true;\n\n\t\t\tapplicableFilters.forEach((filter) => {\n\t\t\t\t\tconst hasThisFilter = element.hasAttribute('data-filter-' + filter.name);\n\t\t\t\t\tconst filterValue =  element.getAttribute('data-filter-' + filter.name);\n\t\t\t\t\tconst elementMatchesFilter = (filterValue && filter.value) ?\n\t\t\t\t\t\tfilterValue.split(' ').includes(filter.value) : false;\n\n\t\t\t\t\tif (!hasThisFilter || !elementMatchesFilter) {\n\t\t\t\t\t\tmatched = false;\n\t\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (matched) {\n\t\t\t\tmatchedItems.push(element);\n\t\t\t}\n\t\t});\n\n\t\treturn matchedItems;\n\t}\n\n\tapplyFilters(element: HTMLElement) {\n\t\tconst listItems = [...element.children].filter((item) => {\n\t\t\treturn !item.classList.contains(this.excludeClass)\n\t\t}) as HTMLElement[];\n\t\tconst matchedItems = this.getMatchedItems(listItems as HTMLElement[]);\n\n\t\t// hide all items\n\t\tlistItems.forEach((el: HTMLElement) => {\n\t\t\tthis.hiddenClass ? el.classList.add(this.hiddenClass) :\n\t\t\t\tel.style.display = 'none';\n\t\t});\n\n\t\t// unhide matched items\n\t\tif (matchedItems.length === 0) {\n\t\t\telement.classList.add('is-empty');\n\t\t} else {\n\t\t\tmatchedItems.forEach((el: HTMLElement) => {\n\t\t\t\tthis.hiddenClass ? el.classList.remove(this.hiddenClass) :\n\t\t\t\t\tel.style.display = '';\n\t\t\t});\n\t\t\telement.classList.remove('is-empty');\n\t\t}\n\n\t\t//add a class to last visible item\n\t\tif (this.lastClass) {\n\t\t\tconst lastVisibleElement = element.querySelector(`.${this.lastClass}`);\n\t\t\tif (lastVisibleElement) {\n\t\t\t\tlastVisibleElement.classList.remove(this.lastClass);\n\t\t\t}\n\n\t\t\tif (matchedItems.length > 0) {\n\t\t\t\tmatchedItems[matchedItems.length - 1].classList.add(this.lastClass);\n\t\t\t}\n\t\t}\n\n\t\tif (typeof this.filtersCallback === 'function') {\n\t\t\tthis.filtersCallback();\n\t\t}\n\t}\n\n\tupdateURL(url: URL, filters:filters) {\n\t\tfilters.forEach((filter) => {\n\t\t\tif (filter.value === undefined ||\n\t\t\t\tfilter.value.length === 0 ||\n\t\t\t\tfilter.value === filter.ignoreValue) {\n\t\t\t\turl.searchParams.delete(filter.name);\n\t\t\t} else {\n\t\t\t\turl.searchParams.set(filter.name, filter.value);\n\t\t\t}\n\t\t});\n\n\t\treturn url;\n\t}\n}\n"],
  "mappings": "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",
  "names": ["filter"]
}
